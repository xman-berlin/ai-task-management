<div th:fragment="list" id="task-list">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Tasks</h5>
        <small class="text-muted" th:text="|Page ${currentPage + 1} of ${page.totalPages} (${page.totalElements} total)|"></small>
    </div>

    <table class="table table-striped align-middle">
        <thead>
        <tr>
            <th style="cursor: pointer;"><a
                    th:href="@{/tasks/list(page=0, size=${pageSize}, sort='title', direction=${sortBy=='title' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    th:hx-get="@{/tasks/list(page=0, size=${pageSize}, sort='title', direction=${sortBy=='title' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    hx-target="#task-list" hx-swap="outerHTML" class="text-decoration-none text-dark">Title <span th:if="${sortBy=='title'}" th:text="${sortDirection=='ASC' ? '↑' : '↓'}"></span></a></th>
            <th style="cursor: pointer;"><a
                    th:href="@{/tasks/list(page=0, size=${pageSize}, sort='priority', direction=${sortBy=='priority' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    th:hx-get="@{/tasks/list(page=0, size=${pageSize}, sort='priority', direction=${sortBy=='priority' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    hx-target="#task-list" hx-swap="outerHTML" class="text-decoration-none text-dark">Priority <span th:if="${sortBy=='priority'}" th:text="${sortDirection=='ASC' ? '↑' : '↓'}"></span></a></th>
            <th style="cursor: pointer;"><a
                    th:href="@{/tasks/list(page=0, size=${pageSize}, sort='status', direction=${sortBy=='status' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    th:hx-get="@{/tasks/list(page=0, size=${pageSize}, sort='status', direction=${sortBy=='status' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    hx-target="#task-list" hx-swap="outerHTML" class="text-decoration-none text-dark">Status <span th:if="${sortBy=='status'}" th:text="${sortDirection=='ASC' ? '↑' : '↓'}"></span></a></th>
            <th style="cursor: pointer;"><a
                    th:href="@{/tasks/list(page=0, size=${pageSize}, sort='dueDate', direction=${sortBy=='dueDate' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    th:hx-get="@{/tasks/list(page=0, size=${pageSize}, sort='dueDate', direction=${sortBy=='dueDate' && sortDirection=='ASC' ? 'DESC' : 'ASC'})}"
                    hx-target="#task-list" hx-swap="outerHTML" class="text-decoration-none text-dark">Due <span th:if="${sortBy=='dueDate'}" th:text="${sortDirection=='ASC' ? '↑' : '↓'}"></span></a></th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="task : ${tasks}">
            <td th:text="${task.title}"></td>
            <td th:text="${task.priority}"></td>
            <td th:text="${task.status}"></td>
            <td th:text="${#temporals.format(task.dueDate, 'yyyy-MM-dd HH:mm')}"></td>
            <td class="text-end">
                <button class="btn btn-sm btn-outline-primary"
                        th:attr="hx-get=@{/tasks/{id}(id=${task.id})}"
                        hx-target="#modal-body"
                        hx-swap="innerHTML"
                        data-bs-toggle="modal"
                        data-bs-target="#taskModal">Edit</button>
                <button class="btn btn-sm btn-outline-danger"
                        th:attr="hx-post=@{/tasks/{id}/delete(id=${task.id})}"
                        hx-target="#task-list"
                        hx-swap="outerHTML">
                    Delete
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <nav aria-label="Task list pagination" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/tasks/list(page=0, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   th:hx-get="@{/tasks/list(page=0, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   hx-target="#task-list" hx-swap="outerHTML">First</a>
            </li>
            <li class="page-item" th:classappend="${!page.hasPrevious() ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/tasks/list(page=${currentPage - 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   th:hx-get="@{/tasks/list(page=${currentPage - 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   hx-target="#task-list" hx-swap="outerHTML">Previous</a>
            </li>
            <li class="page-item active">
                <span class="page-link" th:text="|${currentPage + 1} / ${page.totalPages}|"></span>
            </li>
            <li class="page-item" th:classappend="${!page.hasNext() ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/tasks/list(page=${currentPage + 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   th:hx-get="@{/tasks/list(page=${currentPage + 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   hx-target="#task-list" hx-swap="outerHTML">Next</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == page.totalPages - 1 ? 'disabled' : ''}">
                <a class="page-link"
                   th:href="@{/tasks/list(page=${page.totalPages - 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   th:hx-get="@{/tasks/list(page=${page.totalPages - 1}, size=${pageSize}, sort=${sortBy}, direction=${sortDirection})}"
                   hx-target="#task-list" hx-swap="outerHTML">Last</a>
            </li>
        </ul>
    </nav>
</div>
